<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>산수를 풀어 봅시다</title>
<style>
td {
	padding-left: 10px;
	padding-right: 10px;
}
</style>
<script>
let timerId = null;
let timeLeft = 10;

function calc() {
	if (timerId !== null) {
		clearInterval(timerId);
		timerId = null;
	}
	
	let total = 0;
	let questArray = document.getElementsByClassName("question");
	let ansArray = document.getElementsByClassName("answer");
	
	for(let i=0; i<questArray.length; i++) {
		let question = questArray[i].innerHTML;
		let corrAnswer = eval(question);
		let userAnswer = ansArray[i].value;
		
		if(userAnswer == "" || isNaN(userAnswer)) {
			total += 0;
			questArray[i].style.textDecoration = "line-through";
		} 
        else if(parseFloat(userAnswer) == corrAnswer) { 
			total += 1;
			questArray[i].style.textDecoration = "none";
		} else {
			total += 0;
			questArray[i].style.textDecoration = "line-through";
		}
	}
	document.getElementById("score").innerHTML = total;
}

function startTimer() {
    if (timerId !== null) {
        clearInterval(timerId);
    }
    timeLeft = 10;
    document.getElementById("timer").innerHTML = timeLeft;
    
    timerId = setInterval(() => {
        timeLeft--;
        document.getElementById("timer").innerHTML = timeLeft;
        
        if (timeLeft <= 0) {
            clearInterval(timerId);
            timerId = null;
            calc();
        }
    }, 1000);
}

function makeExp() {
	let questArray = document.getElementsByClassName("question");
	let ansArray = document.getElementsByClassName("answer");
	
	for(let i=0; i<questArray.length; i++) {
        let num1, num2, op, operator;
        
        do {
            num1 = Math.floor(Math.random() * 20) + 1;
            num2 = Math.floor(Math.random() * 20) + 1;
            op = Math.floor(Math.random() * 4);
            operator = "+";

            switch (op) {
                case 0: operator = "+"; break;
                case 1: operator = "-"; break;
                case 2: operator = "*"; break;
                case 3: operator = "/"; break;
            }
        } while (operator === "/" && (num1 % num2 !== 0));

		
		questArray[i].innerHTML = num1 + operator + num2;
		questArray[i].style.textDecoration = "none";
		
		ansArray[i].value = "";
		ansArray[i].disabled = false;
		document.getElementById("score").innerHTML = 0;
	}
    startTimer();
}
</script>
</head>
<body onload="makeExp()">
<h3>산수 문제를 풀어 봅시다.</h3>
문제는 자동으로 생성되며, 10초가 지나면 자동 채점됩니다.<br>
남은 시간: <span id="timer">10</span>초
<hr>
<form>
	<table>
		<tr>
			<td class="question">5*6</td>
			<td><input class="answer" type="text" size="8"></td>
		</tr>
		<tr>
			<td class="question">7+5*3</td>
			<td><input class="answer" type="text" size="8"></td>
		</tr>
		<tr>
			<td class="question">23*2</td>
			<td><input class="answer" type="text" size="8"></td>
		</tr>
		<tr>
			<td class="question">35-7</td>
			<td><input class="answer" type="text" size="8"></td>
		</tr>
		<tr>
			<td>
				<button type="button" onclick="makeExp()">다시</button>
			</td>
			<td><span id="score">0</span></td>
		</tr>
	</table>
</form>
</body>
</html>